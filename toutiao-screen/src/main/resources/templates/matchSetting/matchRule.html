<html xmlns:th="http://www.thymeleaf.org">
<script th:inline="javascript">
    /* <![CDATA[ */
    $(function () {
        //chosen select input
        //$(".chosen-select").chosen({disable_search_threshold: 10});

        $("#updateMatchRule").click(function () {
            $.post("/sys/matchSetting/save", $("#matchRuleForm").serialize(), function (data) {
                //resetMatchRule();
            });
        });
        $("#resettingMatchRule").click(function () {
            resetMatchRule();
        });
        //首轮座位规则回显
        var ruleSeat = $("#ruleSeat").attr("value");
        $("#ruleSeat").find("option").each(function () {
            if ($(this).val() == ruleSeat) {
                $("#ruleSeat_chosen").find("span").html($(this).html());
            }
        });

        $("#next-step").click(function () {
            //do something
            var selectMatch = $("#selectMatch").val();
            if (selectMatch == null || selectMatch == 0) {
                showNotification("提示", "请选择比赛！");
                return;
            }
            var ruleTurn = $("#ruleTurn").val();
            if (ruleTurn == null || ruleTurn == '' || isNaN(ruleTurn)) {
                showNotification("提示", "请填写轮次！");
                return;
            }
            var rulePair = $("#rulePair").val();
            if (rulePair == null || rulePair == '' || isNaN(rulePair)) {
                showNotification("提示", "请填写副数！");
                return;
            }
            var ruleSeat = $("#ruleSeat").val();
            console.log(ruleSeat);
            if (ruleSeat == null || ruleSeat == '' || ruleSeat == '0' || isNaN(ruleSeat)) {
                showNotification("提示", "请选择首轮座位规则！");
                return;
            }
            var ruleWin = $("#ruleWin").val();
            if (ruleWin == null || ruleWin == '' || isNaN(ruleWin)) {
                showNotification("提示", "请填写胜得分！");
                return;
            }
            var ruleFail = $("#ruleFail").val();
            if (ruleFail == null || ruleFail == '' || isNaN(ruleFail)) {
                showNotification("提示", "请填写负得分！");
                return;
            }
            //保存
            $("#updateMatchRule").click();
            $("#updateMatchInfo").click();

            window.localStorage.setItem("IS_LOGIN_ENTER", "0");
            window.localStorage.setItem("CURRENT_MATCH_ID", getMatchId());

            //去签到页面
            $("#signSetting").click();
            showNav();
        });

        var sVal = $("#ruleSeat").attr("value");
        if (sVal != null && sVal != "") {
            $("#ruleSeat").val(sVal);
        }

    })

    function resetMatchRule() {
        //重置基础规则设置
        $("#matchRule").load("/sys/matchSetting/matchRule?token=" + $("#ruleToken").val() + "&matchId=" + $("#nowSettingMatch").val(), function () {
        });
    }

    function showDraw(obj) {
        var isShow = $(obj).val();
        if (isShow == 1) {
            $("#drawShow").show();
        } else {
            $("#drawShow").hide();
            $("#ruleDraw").val("1");
        }
    }

    /* ]]> */
</script>

<style>
    .radio label:before{
        width: 20px;
        height: 20px;
    }

    .radio label:after{
        width: 20px;
        height: 20px;
        top: 7px;
    }

    .form-horizontal .radio, .form-horizontal .checkbox{
        float: left;
    }
</style>
<section class="tile color transparent-black">
    <!-- tile header -->
    <div class="tile-header">
        <h1><strong>基础规则设置</strong></h1>
        <div class="controls">
            <a href="#" class="refresh"><i class="fa fa-refresh"></i></a>
            <a href="#" class="remove"><i class="fa fa-times"></i></a>
        </div>
    </div>
    <!-- /tile header -->
    <!-- tile body -->
    <div class="tile-body">

        <form class="form-horizontal" role="form" id="matchRuleForm">

            <div class="form-group">
                <label class="col-sm-4 control-label">总轮次</label>
                <div class="col-sm-8">
                    <input type="text" class="form-control" id="ruleTurn" name="ruleTurn"
                           th:value="${matchRule}==null?'':${matchRule.ruleTurn}">
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-4 control-label">每轮副数</label>
                <div class="col-sm-8">
                    <input type="text" class="form-control" id="rulePair" name="rulePair"
                           th:value="${matchRule}==null?'':${matchRule.rulePair}">
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-4 control-label">每轮时间</label>
                <div class="col-sm-8">
                    <input type="text" class="form-control" name="ruleTime"
                           th:value="${matchRule}==null?'':${matchRule.ruleTime}">
                </div>
            </div>

            <div class="form-group" th:if="${matchRule.ruleDraw!=1}">
                <label class="col-sm-4 control-label">是否显示平局</label>
                <div class="col-sm-8" id="isShowDraw">
                    <div class="radio radio-transparent">
                        <input type="radio" id="optionsRadios2" value="0" name="checkRuleDraw"
                               onchange="showDraw(this);">
                        <label for="optionsRadios2" style="float: left;"><span style="font-size: 20px">否</span></label>
                    </div>
                    <div class="radio radio-transparent">
                        <input type="radio" id="optionsRadios1" value="1" name="checkRuleDraw" checked
                               onchange="showDraw(this);">
                        <label for="optionsRadios1" style="float: left;"><span style="font-size: 20px">是</span></label>
                    </div>
                </div>
            </div>

            <div class="form-group" th:if="${matchRule.ruleDraw==1}">
                <label class="col-sm-4 control-label">是否显示平局</label>
                <div class="col-sm-8">
                    <div class="radio radio-transparent">
                        <input type="radio" id="optionsRadios2" value="0" name="checkRuleDraw" checked
                               onchange="showDraw(this);">
                        <label for="optionsRadios2" style="float: left;"><span style="font-size: 20px">否</span></label>
                    </div>
                    <div class="radio radio-transparent">
                        <input type="radio" id="optionsRadios1" value="1" name="checkRuleDraw"
                               onchange="showDraw(this);">
                        <label for="optionsRadios1" style="float: left;"><span style="font-size: 20px">是</span></label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-4 control-label">积分设置</label>
                <div class="col-sm-8">
                    <div class="row">
                        <div class="form-group col-sm-6" style="margin-left: 0px">
                            <label style="margin-right: 10px">胜</label>
                            <input type="text" class="form-control" id="ruleWin" name="ruleWin"
                                   th:value="${matchRule}==null?'':${matchRule.ruleWin}">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-sm-6" style="margin-left: 0px">
                            <label style="margin-right: 10px">负</label>
                            <input type="text" class="form-control" id="ruleFail" name="ruleFail"
                                   th:value="${matchRule}==null?'':${matchRule.ruleFail}">
                        </div>
                    </div>
                    <div class="row" id="drawShow" th:if="${matchRule.ruleDraw!=1}">
                        <div class="form-group col-sm-6" style="margin-left: 0px">
                            <label style="margin-right: 10px">平</label>
                            <input type="text" class="form-control" id="ruleDraw" name="ruleDraw"
                                   th:value="${matchRule}==null?'':${matchRule.ruleDraw}">
                        </div>
                    </div>
                    <div class="row" id="drawShow" style="display: none" th:if="${matchRule.ruleDraw==1}">
                        <div class="form-group col-sm-6" style="margin-left: 0px">
                            <label style="margin-right: 10px">平</label>
                            <input type="text" class="form-control" id="ruleDraw" name="ruleDraw"
                                   th:value="${matchRule}==null?'':${matchRule.ruleDraw}">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-4 control-label">首轮座位排序方式</label>
                <div class="col-sm-8">
                    <select class="chosen-select chosen-transparent form-control" id="ruleSeat" th:name="ruleSeat"
                            th:value="${matchRule}==null?'':${matchRule.ruleSeat}">
                        <option th:value="0">请选择首轮编排方式</option>
                        <option th:value="1"> 临近编排</option>
                        <option th:value="2"> 首尾编排</option>
                        <option th:value="3"> 拦腰编排</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-offset-4 col-sm-8">
                    <input type="hidden" th:name="token" th:value="${token}" id="ruleToken">
                    <input type="hidden" th:name="id" th:value="${matchRule}==null?'':${matchRule.id}">
                    <button type="button" class="btn btn-primary" id="updateMatchRule">保存</button>
                    <button type="button" class="btn btn-default" id="resettingMatchRule">重置</button>
                </div>
            </div>
        </form>
    </div>
    <!-- /tile body -->
</section>

<div class="next-btn-box" style="text-align: center">
    <button type="button" id="next-step" style="font-size: 18px; padding: 10px 20px;"
            class="btn btn-green margin-bottom-20">设置完成，下一步
    </button>
</div>